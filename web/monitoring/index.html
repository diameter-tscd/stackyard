<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Admin Monitor</title>
    <!-- Tailwind via Local Script (Offline) -->
    <script src="/assets/vendor/tailwindcss.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        border: "hsl(var(--border))",
                        input: "hsl(var(--input))",
                        ring: "hsl(var(--ring))",
                        background: "hsl(var(--background))",
                        foreground: "hsl(var(--foreground))",
                        primary: {
                            DEFAULT: "hsl(var(--primary))",
                            foreground: "hsl(var(--primary-foreground))",
                        },
                        secondary: {
                            DEFAULT: "hsl(var(--secondary))",
                            foreground: "hsl(var(--secondary-foreground))",
                        },
                        destructive: {
                            DEFAULT: "hsl(var(--destructive))",
                            foreground: "hsl(var(--destructive-foreground))",
                        },
                        muted: {
                            DEFAULT: "hsl(var(--muted))",
                            foreground: "hsl(var(--muted-foreground))",
                        },
                        accent: {
                            DEFAULT: "hsl(var(--accent))",
                            foreground: "hsl(var(--accent-foreground))",
                        },
                        popover: {
                            DEFAULT: "hsl(var(--popover))",
                            foreground: "hsl(var(--popover-foreground))",
                        },
                        card: {
                            DEFAULT: "hsl(var(--card))",
                            foreground: "hsl(var(--card-foreground))",
                        },
                    },
                    borderRadius: {
                        lg: "var(--radius)",
                        md: "calc(var(--radius) - 2px)",
                        sm: "calc(var(--radius) - 4px)",
                    },
                    fontFamily: {
                        sans: ['Lexend', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 240 10% 3.9%;
            --card: 0 0% 100%;
            --card-foreground: 240 10% 3.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 240 10% 3.9%;
            --primary: 240 5.9% 10%;
            --primary-foreground: 0 0% 98%;
            --secondary: 240 4.8% 95.9%;
            --secondary-foreground: 240 5.9% 10%;
            --muted: 240 4.8% 95.9%;
            --muted-foreground: 240 3.8% 46.1%;
            --accent: 240 4.8% 95.9%;
            --accent-foreground: 240 5.9% 10%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 0 0% 98%;
            --border: 240 5.9% 90%;
            --input: 240 5.9% 90%;
            --ring: 240 10% 3.9%;
            --radius: 0.5rem;
        }

        .dark {
            --background: 224 71.4% 4.1%;
            --foreground: 210 20% 98%;
            --card: 224 71.4% 4.1%;
            --card-foreground: 210 20% 98%;
            --popover: 224 71.4% 4.1%;
            --popover-foreground: 210 20% 98%;
            --primary: 210 20% 98%;
            --primary-foreground: 220.9 39.3% 11%;
            --secondary: 215 27.9% 16.9%;
            --secondary-foreground: 210 20% 98%;
            --muted: 215 27.9% 16.9%;
            --muted-foreground: 217.9 10.6% 64.9%;
            --accent: 215 27.9% 16.9%;
            --accent-foreground: 210 20% 98%;
            --destructive: 0 62.8% 30.6%;
            --destructive-foreground: 210 20% 98%;
            --border: 215 27.9% 16.9%;
            --input: 215 27.9% 16.9%;
            --ring: 216 12.2% 83.9%;
        }
    </style>
    <link rel="stylesheet" href="assets/css/style.css">
    <!-- Font Lexend (Local fonts for offline support) -->
    <link rel="stylesheet" href="assets/vendor/fonts/lexend.css">
    <script>
        // Check theme immediately to prevent FOUC
        if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
    <script defer src="/assets/vendor/alpine.min.js"></script>
    <!-- Notyf (Local Offline) -->
    <link rel="stylesheet" href="assets/vendor/notyf/notyf.min.css">

    <!-- CodeMirror 5 (Local Offline) -->
    <link rel="stylesheet" href="assets/vendor/codemirror/codemirror.min.css">
    <link rel="stylesheet" href="assets/vendor/codemirror/theme/dracula.min.css">
    <script src="assets/vendor/codemirror/codemirror.min.js"></script>
    <script src="assets/vendor/codemirror/mode/yaml.min.js"></script>
    <script src="assets/vendor/codemirror/mode/shell.min.js"></script>
    <script src="/assets/vendor/codemirror-sql.min.js"></script>
    <style>
        .CodeMirror {
            height: 600px !important;
            border-radius: 0.375rem;
            /* rounded-md */
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 13px;
        }

        /* Add padding to CodeMirror content */
        .CodeMirror-lines {
            padding: 8px 0 !important;
        }

        .CodeMirror pre.CodeMirror-line,
        .CodeMirror pre.CodeMirror-line-like {
            padding-left: 12px !important;
        }

        /* Override for SQL Editor to not be too huge */
        #sqlEditor+.CodeMirror {
            height: 250px !important;
        }
    </style>
    <style>
        /* Notyf Customization (Shadcn Style) */
        .notyf {
            z-index: 99999 !important;
            /* Force on top of everything */
            pointer-events: none;
            /* Container passes clicks */
            position: fixed !important;
            /* Ensure fixed positioning */
            padding-bottom: env(safe-area-inset-bottom);
            /* Mobile safe area */
        }

        .notyf__toast {
            border-radius: 0.5rem !important;
            /* rounded-lg */
            font-family: inherit !important;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1) !important;
            padding: 0 16px !important;
            pointer-events: auto !important;
            /* Toasts capture clicks */
        }

        .notyf__message {
            font-size: 0.875rem !important;
            /* text-sm */
            font-weight: 500 !important;
        }

        /* Custom Variables */
        body {
            font-family: 'Lexend', -apple-system, BlinkMacSystemFont, sans-serif;
            font-weight: 400;
        }

        button:active {
            transform: scale(0.95);
            transition: transform 0.1s;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 14px;
            height: 14px;
        }

        ::-webkit-scrollbar-track {
            background: hsl(var(--muted));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: hsl(var(--muted-foreground) / 0.5);
            border: 2px solid hsl(var(--muted));
            background-clip: padding-box;
            border-radius: 9999px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: hsl(var(--muted-foreground) / 0.8);
        }

        .dark ::-webkit-scrollbar-thumb {
            background: hsl(var(--muted-foreground) / 0.5);
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: hsl(var(--muted-foreground) / 0.8);
        }
    </style>
</head>

<body class="bg-background text-foreground antialiased" x-data="app()">

    <div class="fixed inset-0 flex overflow-hidden bg-background">
        <!-- Mobile Sidebar Backdrop -->
        <div x-show="sidebarOpen" @click="sidebarOpen = false"
            x-transition:enter="transition-opacity ease-linear duration-300" x-transition:enter-start="opacity-0"
            x-transition:enter-end="opacity-100" x-transition:leave="transition-opacity ease-linear duration-300"
            x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0"
            class="fixed inset-0 bg-gray-900/80 z-40 md:hidden backdrop-blur-sm"></div>

        <!-- Sidebar -->
        <aside :class="[
                sidebarOpen ? 'translate-x-0' : '-translate-x-full',
                sidebarCollapsed ? 'md:w-[70px]' : 'md:w-64',
                'fixed inset-y-0 left-0 z-50 flex flex-col border-r bg-card transition-all duration-300 md:relative md:translate-x-0 w-64 h-full overflow-hidden'
            ]">
            <div class="flex h-14 lg:h-[60px] items-center border-b px-4 sm:px-6 justify-between"
                :class="sidebarCollapsed ? 'justify-center px-0' : ''">
                <a class="flex items-center gap-2 font-semibold" href="#">
                    <div
                        class="flex h-6 w-6 sm:h-7 sm:w-7 items-center justify-center rounded-md bg-primary text-primary-foreground shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="h-3 w-3 sm:h-4 sm:w-4">
                            <path d="M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3" />
                        </svg>
                    </div>
                    <div class="flex flex-col overflow-hidden transition-all duration-300" x-show="!sidebarCollapsed"
                        x-transition:enter="transition ease-out duration-300" x-transition:enter-start="opacity-0 w-0"
                        x-transition:enter-end="opacity-100 w-auto">
                        <span class="text-sm sm:text-base leading-none truncate" x-text="monitoringConfig.title"></span>
                        <span
                            class="text-[9px] sm:text-[10px] font-normal text-muted-foreground leading-none mt-0.5 truncate"
                            x-text="monitoringConfig.subtitle"></span>
                    </div>
                </a>

                <!-- Mobile Close Button -->
                <button @click="sidebarOpen = false" class="md:hidden text-muted-foreground hover:text-foreground">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

            <div class="flex-1 overflow-x-hidden overflow-y-auto py-4 min-h-0 relative h-full"
                style="touch-action: pan-y;">
                <nav class="grid items-start px-2 text-sm font-medium">
                    <template x-for="category in menuCategories" :key="category.name">
                        <div class="pb-4">
                            <!-- Category Header -->
                            <h3 class="mb-2 px-4 text-[10px] font-semibold text-muted-foreground uppercase tracking-wider truncate"
                                x-show="!sidebarCollapsed" x-text="category.name"></h3>
                            <div class="h-px bg-border/50 mx-2 mb-2" x-show="sidebarCollapsed"></div>

                            <!-- Category Items -->
                            <div class="space-y-1">
                                <template x-for="item in category.items" :key="item.id">
                                    <button @click="activeTab = item.id" :class="[
                                            activeTab === item.id ? 'bg-primary text-primary-foreground shadow-sm' : 'text-muted-foreground hover:bg-accent hover:text-accent-foreground',
                                            sidebarCollapsed ? 'justify-center px-0 py-2' : 'px-3 py-2'
                                        ]"
                                        class="w-full flex items-center gap-3 rounded-md transition-all relative group">

                                        <div class="shrink-0 flex items-center justify-center">
                                            <span class="[&>svg]:h-4 [&>svg]:w-4" x-html="item.icon"></span>
                                        </div>

                                        <span class="flex-1 text-left truncate" x-show="!sidebarCollapsed"
                                            x-text="item.label"></span>

                                        <!-- Tooltip for collapsed state -->
                                        <div x-show="sidebarCollapsed"
                                            class="absolute left-full ml-2 px-2 py-1 bg-popover text-popover-foreground text-xs rounded-md shadow-md border opacity-0 group-hover:opacity-100 transition-opacity z-50 pointer-events-none whitespace-nowrap"
                                            x-text="item.label"></div>

                                        <!-- Badge for Endpoints -->
                                        <span
                                            x-show="!sidebarCollapsed && item.id === 'endpoints' && activeEndpointsCount > 0"
                                            class="ml-auto flex h-5 w-5 items-center justify-center rounded-full bg-primary text-primary-foreground text-[10px] font-bold"
                                            :class="activeTab === item.id ? 'bg-primary-foreground text-primary' : ''"
                                            x-text="activeEndpointsCount"></span>
                                        <div x-show="sidebarCollapsed && item.id === 'endpoints' && activeEndpointsCount > 0"
                                            class="absolute top-0 right-0 h-2 w-2 rounded-full bg-red-500"></div>

                                        <!-- Badge for Cron Jobs -->
                                        <span x-show="!sidebarCollapsed && item.id === 'cron' && activeCronCount > 0"
                                            class="ml-auto flex h-5 w-5 items-center justify-center rounded-full bg-primary text-primary-foreground text-[10px] font-bold"
                                            :class="activeTab === item.id ? 'bg-primary-foreground text-primary' : ''"
                                            x-text="activeCronCount"></span>
                                    </button>
                                </template>
                            </div>
                        </div>
                    </template>
                </nav>
            </div>

            <div class="border-t p-2">
                <div class="flex items-center gap-3 rounded-lg border bg-muted/50 p-2 shadow-sm"
                    :class="sidebarCollapsed ? 'justify-center' : ''">
                    <div class="flex h-8 w-8 shrink-0 items-center justify-center rounded-sm bg-background">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="h-4 w-4 text-green-500">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                            <polyline points="22 4 12 14.01 9 11.01"></polyline>
                        </svg>
                    </div>
                    <div class="flex flex-col gap-0.5 text-xs overflow-hidden" x-show="!sidebarCollapsed">
                        <span class="font-medium text-foreground truncate">System Healthy</span>
                        <span class="text-muted-foreground truncate">All systems go</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex flex-1 flex-col overflow-hidden relative">
            <!-- Header -->
            <header
                class="absolute top-0 left-0 right-0 z-20 flex h-14 items-center justify-between gap-4 border-b bg-background/80 backdrop-blur-md px-6 lg:h-[60px] transition-all">

                <!-- Mobile Toggle -->
                <button @click="sidebarOpen = !sidebarOpen"
                    class="md:hidden text-muted-foreground hover:text-foreground">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>

                <!-- Desktop Toggle -->
                <button @click="sidebarCollapsed = !sidebarCollapsed"
                    class="hidden md:flex text-muted-foreground hover:text-foreground transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="18" height="18" x="3" y="3" rx="2" ry="2" />
                        <line x1="9" x2="9" y1="3" y2="21" />
                    </svg>
                </button>

                <div class="w-full flex-1 ml-4">
                    <h1 class="text-base sm:text-lg md:text-xl font-semibold" x-text="activeTabLabel"></h1>
                </div>

                <div class="flex items-center gap-4">
                    <button @click="toggleTheme()"
                        class="inline-flex h-9 w-9 items-center justify-center rounded-md border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground">
                        <svg x-show="!isDark" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        <svg x-show="isDark" style="display:none" xmlns="http://www.w3.org/2000/svg" width="18"
                            height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </button>

                    <div class="relative" x-data="{ open: false }">
                        <button @click="open = !open"
                            class="inline-flex h-9 w-9 items-center justify-center rounded-full bg-secondary text-secondary-foreground border border-input shadow-sm hover:bg-accent/50 overflow-hidden">
                            <template x-if="userSettings.photoPath">
                                <img :src="'/api/user/photos/' + userSettings.photoPath" alt="Profile"
                                    class="h-full w-full object-cover">
                            </template>
                            <template x-if="!userSettings.photoPath">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="none"
                                    stroke="currentColor" stroke-width="2">
                                    <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </template>
                        </button>
                        <div x-show="open" @click.outside="open = false"
                            class="absolute right-0 mt-2 w-56 rounded-md border bg-popover text-popover-foreground shadow-md outline-none animate-in fade-in-80 zoom-in-95 z-50 p-1"
                            style="display: none;">
                            <div class="px-2 py-1.5 text-sm font-semibold"
                                x-text="userSettings.username || 'My Account'"></div>
                            <div class="h-px bg-muted my-1"></div>
                            <div @click="activeTab = 'settings'; open = false"
                                class="px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground cursor-pointer rounded-sm">
                                Profile</div>
                            <div @click="activeTab = 'settings'; open = false"
                                class="px-2 py-1.5 text-sm outline-none transition-colors hover:bg-accent hover:text-accent-foreground cursor-pointer rounded-sm">
                                Settings</div>
                            <div class="h-px bg-muted my-1"></div>
                            <button @click="logout()"
                                class="w-full text-left px-2 py-1.5 text-sm text-red-500 outline-none transition-colors hover:bg-red-100 dark:hover:bg-red-900/20 cursor-pointer rounded-sm">Log
                                out</button>
                        </div>
                    </div>
                </div>
            </header>

            <main class="flex-1 overflow-y-auto p-4 lg:p-6 bg-muted/40 min-h-0 relative h-full"
                style="padding-top: 100px; touch-action: pan-y;">
                <!-- Dashboard Tab -->
                <div x-show="activeTab === 'dashboard'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-4"
                    x-transition:enter-end="opacity-100 translate-y-0">
                    <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
                        <!-- Stats Cards -->
                        <div class="p-6 rounded-xl border bg-card text-card-foreground shadow-sm">
                            <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                <h3 class="tracking-tight text-sm font-medium">Total Services</h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="text-muted-foreground">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold" x-text="serviceCount">0</div>
                            <div class="text-xs text-muted-foreground flex items-center gap-1">
                                <span class="w-2 h-2 rounded-full bg-green-500"></span> Active
                            </div>
                        </div>

                        <!-- Infra Stats -->
                        <div class="p-6 rounded-xl border bg-card text-card-foreground shadow-sm">
                            <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                <h3 class="tracking-tight text-sm font-medium">Infrastructure</h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="text-muted-foreground">
                                    <path d="M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242"></path>
                                    <path d="M12 12v9"></path>
                                    <path d="m8 17 4 4 4-4"></path>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold">
                                <span x-text="infraStats.active">0</span>/<span x-text="infraStats.total">0</span>
                            </div>
                            <div class="text-xs text-muted-foreground flex gap-1 flex-wrap mt-1">
                                <template x-for="item in infraStats.items">
                                    <span class="px-1 py-0.5 rounded text-[10px]"
                                        :class="item.active ? 'bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300' : 'bg-gray-100 text-gray-500 dark:bg-gray-800 dark:text-gray-500'"
                                        x-text="item.name"></span>
                                </template>
                            </div>
                        </div>

                        <!-- System Info -->
                        <div class="p-6 rounded-xl border bg-card text-card-foreground shadow-sm">
                            <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                <h3 class="tracking-tight text-sm font-medium">Server Info</h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="text-muted-foreground">
                                    <rect x="2" y="2" width="20" height="8" rx="2" ry="2"></rect>
                                    <rect x="2" y="14" width="20" height="8" rx="2" ry="2"></rect>
                                    <line x1="6" y1="6" x2="6.01" y2="6"></line>
                                    <line x1="6" y1="18" x2="6.01" y2="18"></line>
                                </svg>
                            </div>
                            <div class="flex flex-col gap-1">
                                <div class="text-sm font-medium truncate" x-text="sysInfo.hostname || '...'"></div>
                                <div class="text-xs text-muted-foreground font-mono" x-text="sysInfo.ip || '...'"></div>
                            </div>
                        </div>

                        <!-- Disk Usage -->
                        <div class="p-6 rounded-xl border bg-card text-card-foreground shadow-sm">
                            <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                <h3 class="tracking-tight text-sm font-medium">Disk Usage</h3>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="text-muted-foreground">
                                    <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                                </svg>
                            </div>
                            <div class="text-2xl font-bold">
                                <span x-text="Math.round(sysInfo.disk.used_percent || 0)">0</span>%
                            </div>
                            <p class="text-xs text-muted-foreground">
                                <span x-text="sysInfo.disk.used_gb || 0">0</span>GB / <span
                                    x-text="sysInfo.disk.total_gb || 0">0</span>GB
                            </p>
                            <div class="w-full bg-secondary h-1.5 mt-2 rounded-full overflow-hidden">
                                <div class="bg-primary h-full transition-all duration-500"
                                    :style="`width: ${sysInfo.disk.used_percent || 0}%`"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Endpoints Tab -->
                    <!-- Live Logs -->
                    <div class="rounded-xl border bg-card text-card-foreground shadow-sm flex flex-col h-[400px]">
                        <div
                            class="px-6 py-4 flex justify-between items-center border-b relative z-20 overflow-visible">
                            <div class="flex items-center gap-4">
                                <h3 class="font-semibold text-lg tracking-tight">Live Logs</h3>

                                <!-- Custom Shadcn-style Dropdown -->
                                <div class="relative" x-data="{ open: false }">
                                    <button @click="open = !open" @click.outside="open = false"
                                        class="flex items-center gap-2 h-8 px-3 text-xs font-medium border rounded-md bg-background hover:bg-accent hover:text-accent-foreground transition-colors focus:outline-none focus:ring-1 focus:ring-ring">
                                        <span class="text-muted-foreground mr-1">Throttle:</span>
                                        <span
                                            x-text="logThrottle == 500 ? '500ms' : (logThrottle == 1000 ? '1s' : '2s')"></span>
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round" class="opacity-50">
                                            <path d="m6 9 6 6 6-6" />
                                        </svg>
                                    </button>
                                    <div x-show="open" x-transition:enter="transition ease-out duration-100"
                                        x-transition:enter-start="opacity-0 scale-95"
                                        x-transition:enter-end="opacity-100 scale-100"
                                        x-transition:leave="transition ease-in duration-75"
                                        x-transition:leave-start="opacity-100 scale-100"
                                        x-transition:leave-end="opacity-0 scale-95"
                                        class="absolute top-full left-0 mt-1 w-32 rounded-md border bg-popover text-popover-foreground shadow-md z-[100] p-1"
                                        style="display: none;">
                                        <div @click="logThrottle = 500; updateThrottle(); open = false"
                                            class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                            <span x-show="logThrottle == 500" class="absolute right-2 text-xs">✓</span>
                                            500ms
                                        </div>
                                        <div @click="logThrottle = 1000; updateThrottle(); open = false"
                                            class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                            <span x-show="logThrottle == 1000" class="absolute right-2 text-xs">✓</span>
                                            1s
                                        </div>
                                        <div @click="logThrottle = 2000; updateThrottle(); open = false"
                                            class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                            <span x-show="logThrottle == 2000" class="absolute right-2 text-xs">✓</span>
                                            2s
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="flex items-center gap-2">
                                <button @click="toggleDummyLog()"
                                    :class="dummyLogActive ? 'bg-green-500/10 text-green-600 hover:bg-green-500/20 border-green-200' : 'bg-secondary text-secondary-foreground hover:bg-secondary/80'"
                                    class="h-8 px-3 text-xs rounded-md transition-colors font-medium border border-transparent">
                                    <span x-text="dummyLogActive ? 'Dummy Logs: ON' : 'Enable Dummy Logs'"></span>
                                </button>
                                <button @click="logs = []"
                                    class="h-8 px-3 text-xs bg-secondary text-secondary-foreground hover:bg-secondary/80 rounded-md transition-colors font-medium">
                                    Clear
                                </button>
                            </div>
                        </div>

                        <!-- Log Viewer (Light/Clean Design) -->
                        <div class="flex-1 bg-white dark:bg-slate-950 px-0 py-2 overflow-y-auto font-mono text-sm"
                            id="logs-box">
                            <div class="flex flex-col w-full">
                                <template x-for="log in logs">
                                    <div class="w-full px-6 py-2 border-b border-border hover:bg-muted/50 transition-colors group"
                                        x-html="formatLog(log)"></div>
                                </template>
                                <div x-show="logs.length === 0"
                                    class="p-8 text-center text-muted-foreground text-sm italic">
                                    Waiting for logs...
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Storage Tab -->
                <div x-show="activeTab === 'storage'" x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100" class="space-y-6" style="display: none;">
                    <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                        <!-- MinIO Status -->
                        <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                            <div class="p-6 flex flex-row items-center justify-between pb-2">
                                <h3 class="font-semibold leading-none tracking-tight">MinIO Storage</h3>
                                <div class="h-2 w-2 rounded-full"
                                    :class="storage.connected ? 'bg-green-500' : 'bg-red-500'"></div>
                            </div>
                            <div class="p-6 pt-0">
                                <div class="text-2xl font-bold"
                                    x-text="storage.connected ? 'Connected' : 'Disconnected'"></div>
                                <p class="text-xs text-muted-foreground mt-1"
                                    x-text="storage.endpoint || 'No endpoint configured'"></p>

                                <div class="mt-4 space-y-2" x-show="storage.connected">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-muted-foreground">Bucket</span>
                                        <span class="font-medium" x-text="storage.bucket_name"></span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-muted-foreground">Objects</span>
                                        <span class="font-medium" x-text="storage.object_count || 0"></span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-muted-foreground">Total Size</span>
                                        <span class="font-medium"><span x-text="storage.total_size_kb || 0"></span>
                                            KB</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- External Tab -->
                <div x-show="activeTab === 'external'" x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100" class="space-y-6" style="display: none;">
                    <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                        <div class="p-6 border-b">
                            <h3 class="font-semibold leading-none tracking-tight">External Services Connectivity</h3>
                        </div>
                        <div class="p-0">
                            <div class="relative w-full overflow-auto">
                                <table class="w-full caption-bottom text-sm">
                                    <thead class="[&_tr]:border-b">
                                        <tr
                                            class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                                            <th
                                                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                                Service Name</th>
                                            <th
                                                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                                URL</th>
                                            <th
                                                class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                                Latency</th>
                                            <th
                                                class="h-12 px-4 text-right align-middle font-medium text-muted-foreground">
                                                Status</th>
                                        </tr>
                                    </thead>
                                    <tbody class="[&_tr:last-child]:border-0">
                                        <template x-for="svc in external" :key="svc.name">
                                            <tr
                                                class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                                                <td class="p-4 align-middle font-medium" x-text="svc.name"></td>
                                                <td class="p-4 align-middle text-muted-foreground text-xs"
                                                    x-text="svc.url"></td>
                                                <td class="p-4 align-middle">
                                                    <span x-text="svc.latency_ms + ' ms'"></span>
                                                </td>
                                                <td class="p-4 align-middle text-right">
                                                    <span
                                                        class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
                                                        :class="svc.status === 'up' ? 'border-transparent bg-green-500 text-white shadow hover:bg-green-600' : 'border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80'"
                                                        x-text="svc.status.toUpperCase()">
                                                    </span>
                                                </td>
                                            </tr>
                                        </template>
                                        <tr x-show="!external || external.length === 0">
                                            <td colspan="4" class="p-4 text-center text-muted-foreground">No external
                                                services configured.</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Tab -->
                <div x-show="activeTab === 'system'" x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100" class="space-y-6" style="display: none;">

                    <!-- Controls -->
                    <div class="flex justify-end">
                        <div class="relative" x-data="{ open: false }">
                            <button @click="open = !open" @click.outside="open = false"
                                class="flex items-center gap-2 h-8 px-3 text-xs font-medium border rounded-md bg-background hover:bg-accent hover:text-accent-foreground transition-colors focus:outline-none focus:ring-1 focus:ring-ring">
                                <span class="text-muted-foreground mr-1">Graph Update:</span>
                                <span
                                    x-text="graphThrottle == 500 ? '500ms' : (graphThrottle == 1000 ? '1s' : (graphThrottle == 2000 ? '2s' : '5s'))"></span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="opacity-50">
                                    <path d="m6 9 6 6 6-6" />
                                </svg>
                            </button>
                            <div x-show="open"
                                class="absolute right-0 mt-1 w-32 rounded-md border bg-popover text-popover-foreground shadow-md z-[100] p-1"
                                style="display: none;">
                                <div @click="graphThrottle = 500; open = false"
                                    class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                    <span x-show="graphThrottle == 500" class="absolute right-2 text-xs">✓</span>500ms
                                </div>
                                <div @click="graphThrottle = 1000; open = false"
                                    class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                    <span x-show="graphThrottle == 1000" class="absolute right-2 text-xs">✓</span>1s
                                </div>
                                <div @click="graphThrottle = 2000; open = false"
                                    class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                    <span x-show="graphThrottle == 2000" class="absolute right-2 text-xs">✓</span>2s
                                </div>
                                <div @click="graphThrottle = 5000; open = false"
                                    class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                    <span x-show="graphThrottle == 5000" class="absolute right-2 text-xs">✓</span>5s
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid gap-6 md:grid-cols-2">
                        <!-- CPU Card -->
                        <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                            <div class="p-6 pb-2">
                                <h3 class="font-semibold leading-none tracking-tight">CPU Usage</h3>
                                <div class="text-2xl font-bold mt-2" x-text="(system.cpu?.usage_percent || 0) + '%'">
                                </div>
                            </div>
                            <div class="p-6 pt-0 h-[200px] w-full">
                                <!-- Simple SVG Graph -->
                                <svg class="w-full h-full overflow-visible" viewBox="0 0 100 100"
                                    preserveAspectRatio="none">
                                    <!-- Grid lines -->
                                    <line x1="0" y1="0" x2="100" y2="0" stroke="currentColor" stroke-opacity="0.1"
                                        vector-effect="non-scaling-stroke" />
                                    <line x1="0" y1="50" x2="100" y2="50" stroke="currentColor" stroke-opacity="0.1"
                                        vector-effect="non-scaling-stroke" />
                                    <line x1="0" y1="100" x2="100" y2="100" stroke="currentColor" stroke-opacity="0.1"
                                        vector-effect="non-scaling-stroke" />

                                    <!-- Path -->
                                    <path fill="none" class="stroke-primary" stroke-width="2"
                                        vector-effect="non-scaling-stroke"
                                        :d="`M ${sysHistory.cpu.map((v, i) => `${(i / (sysHistory.cpu.length - 1)) * 100},${100 - v}`).join(' L ')}`" />
                                    <!-- Fill area (optional, opacity) -->
                                    <path class="fill-primary/20" stroke="none" vector-effect="non-scaling-stroke"
                                        :d="`M 0,100 L ${sysHistory.cpu.map((v, i) => `${(i / (sysHistory.cpu.length - 1)) * 100},${100 - v}`).join(' L ')} L 100,100 Z`" />
                                </svg>
                            </div>
                        </div>

                        <!-- RAM Card -->
                        <div class="rounded-lg border bg-card text-card-foreground shadow-sm">
                            <div class="p-6 pb-2">
                                <h3 class="font-semibold leading-none tracking-tight">Memory Usage</h3>
                                <div class="text-2xl font-bold mt-2" x-text="(system.memory?.used_percent || 0) + '%'">
                                </div>
                                <p class="text-xs text-muted-foreground"
                                    x-text="`${system.memory?.used_gb || 0} GB / ${system.memory?.total_gb || 0} GB`">
                                </p>
                            </div>
                            <div class="p-6 pt-0 h-[200px] w-full">
                                <svg class="w-full h-full overflow-visible" viewBox="0 0 100 100"
                                    preserveAspectRatio="none">
                                    <line x1="0" y1="0" x2="100" y2="0" stroke="currentColor" stroke-opacity="0.1"
                                        vector-effect="non-scaling-stroke" />
                                    <line x1="0" y1="50" x2="100" y2="50" stroke="currentColor" stroke-opacity="0.1"
                                        vector-effect="non-scaling-stroke" />
                                    <line x1="0" y1="100" x2="100" y2="100" stroke="currentColor" stroke-opacity="0.1"
                                        vector-effect="non-scaling-stroke" />

                                    <path fill="none" class="stroke-primary" stroke-width="2"
                                        vector-effect="non-scaling-stroke"
                                        :d="`M ${sysHistory.ram.map((v, i) => `${(i / (sysHistory.ram.length - 1)) * 100},${100 - v}`).join(' L ')}`" />
                                    <path class="fill-primary/20" stroke="none" vector-effect="non-scaling-stroke"
                                        :d="`M 0,100 L ${sysHistory.ram.map((v, i) => `${(i / (sysHistory.ram.length - 1)) * 100},${100 - v}`).join(' L ')} L 100,100 Z`" />
                                </svg>
                            </div>
                        </div>

                        <!-- Disk Card -->
                        <div class="rounded-lg border bg-card text-card-foreground shadow-sm md:col-span-2">
                            <div class="p-6 flex flex-col gap-4">
                                <div>
                                    <h3 class="font-semibold leading-none tracking-tight">Disk Usage (C:)</h3>
                                    <p class="text-xs text-muted-foreground mt-1" x-text="system.disk?.path || '/'"></p>
                                </div>
                                <div class="flex items-center gap-4">
                                    <div class="flex-1 h-4 bg-secondary rounded-full overflow-hidden">
                                        <div class="h-full bg-primary transition-all duration-500"
                                            :style="`width: ${system.disk?.used_percent || 0}%`"></div>
                                    </div>
                                    <div class="text-sm font-medium w-24 text-right"
                                        x-text="(system.disk?.used_percent || 0) + '%'"></div>
                                </div>
                                <div class="flex justify-between text-xs text-muted-foreground">
                                    <span x-text="`Used: ${system.disk?.used_gb || 0} GB`"></span>
                                    <span x-text="`Total: ${system.disk?.total_gb || 0} GB`"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div x-show="activeTab === 'endpoints'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 transform translate-y-4"
                    x-transition:enter-end="opacity-100 transform translate-y-0">
                    <div class="rounded-md border bg-card">
                        <div class="relative w-full overflow-auto">
                            <table class="w-full caption-bottom text-sm">
                                <thead class="[&_tr]:border-b">
                                    <tr
                                        class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                                        <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                            Service Name</th>
                                        <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                            Endpoint</th>
                                        <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                            Status</th>
                                        <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                            Struct/Class</th>
                                    </tr>
                                </thead>
                                <tbody class="[&_tr:last-child]:border-0">
                                    <template x-for="svc in endpoints">
                                        <tr class="border-b transition-colors hover:bg-muted/50">
                                            <td class="p-4 align-middle font-medium" x-text="svc.name"></td>
                                            <td class="p-4 align-middle text-muted-foreground"
                                                x-text="svc.endpoints ? svc.endpoints.join(', ') : ''">
                                            </td>
                                            <td class="p-4 align-middle">
                                                <span
                                                    class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2"
                                                    :class="svc.active ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300' : 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300'">
                                                    <span x-text="svc.active ? 'Active' : 'Inactive'"></span>
                                                </span>
                                            </td>
                                            <td class="p-4 align-middle font-mono text-xs" x-text="svc.struct_name">
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Redis Tab -->
                <div x-show="activeTab === 'redis'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-4"
                    x-transition:enter-end="opacity-100 translate-y-0">
                    <!-- Connected View -->
                    <div x-show="infraStatus.redis">
                        <div class="flex gap-4 mb-6">
                            <div class="flex-1 relative">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" class="absolute left-3 top-3 text-muted-foreground">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                                </svg>
                                <input type="text" x-model="redisPattern" placeholder="Search keys (e.g. user:*)..."
                                    class="flex h-10 w-full rounded-md border border-input bg-background pl-10 pr-3 py-2 text-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring">
                            </div>
                            <button @click="fetchRedisKeys()"
                                class="h-10 px-4 py-2 bg-primary text-primary-foreground hover:bg-primary/90 inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors">Scan
                                Keys</button>
                        </div>

                        <div class="rounded-md border bg-card">
                            <table class="w-full caption-bottom text-sm">
                                <thead class="[&_tr]:border-b">
                                    <tr
                                        class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                                        <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                            Key
                                            Name</th>
                                        <th class="h-12 px-4 text-right align-middle font-medium text-muted-foreground">
                                            Action</th>
                                    </tr>
                                </thead>
                                <tbody class="[&_tr:last-child]:border-0">
                                    <template x-for="key in redisKeys">
                                        <tr class="border-b transition-colors hover:bg-muted/50">
                                            <td class="p-4 align-middle font-mono text-xs" x-text="key"></td>
                                            <td class="p-4 align-middle text-right">
                                                <button @click="viewRedisValue(key)"
                                                    class="text-primary hover:underline text-xs font-medium">View
                                                    Value</button>
                                            </td>
                                        </tr>
                                    </template>
                                    <tr x-show="redisKeys.length === 0">
                                        <td colspan="2" class="p-8 text-center text-muted-foreground">No keys found. Try
                                            scanning with *.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Disconnected View -->
                    <div x-show="!infraStatus.redis"
                        class="flex flex-col items-center justify-center py-16 text-center">
                        <div
                            class="w-16 h-16 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-full flex items-center justify-center mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path
                                    d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                                </path>
                                <line x1="12" y1="9" x2="12" y2="13"></line>
                                <line x1="12" y1="17" x2="12.01" y2="17"></line>
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Redis Not Connected</h3>
                        <p class="text-muted-foreground max-w-sm">
                            The Redis connection is currently disabled or failed to establish.
                            Check your <code class="bg-muted px-1 py-0.5 rounded text-xs">config.yaml</code> and ensure
                            Redis is enabled and running.
                        </p>
                    </div>
                </div>

                <!-- Postgres Tab -->
                <div x-show="activeTab === 'postgres'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-4"
                    x-transition:enter-end="opacity-100 translate-y-0">

                    <template x-if="!infraStatus.postgres">
                        <div class="p-12 text-center text-muted-foreground rounded-md border border-dashed">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round"
                                stroke-linejoin="round" class="mx-auto mb-4 opacity-50">
                                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                <path d="M3 5v14c0 1.66 4 3 9 3s 9-1.34 9-3V5"></path>
                            </svg>
                            <h3 class="text-lg font-medium">Postgres is disconnected</h3>
                            <p class="mt-1">Check your configuration and ensure the database is running.</p>
                        </div>
                    </template>

                    <template x-if="infraStatus.postgres">
                        <div class="space-y-6">
                            <!-- Database Connection Selector -->
                            <div class="rounded-md border bg-card shadow-sm p-4">
                                <div class="flex items-center gap-4">
                                    <div class="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                                            <path d="M2 12h20"></path>
                                            <path d="M12 2v20"></path>
                                            <path d="M20 20a1 1 0 1 0 2 0a1 1 0 1 0-2 0"></path>
                                            <path d="M4 20a1 1 0 1 0 2 0a1 1 0 1 0-2 0"></path>
                                            <path d="M20 4a1 1 0 1 0 2 0a1 1 0 1 0-2 0"></path>
                                            <path d="M4 4a1 1 0 1 0 2 0a1 1 0 1 0-2 0"></path>
                                        </svg>
                                        <span class="font-medium">Database Connection:</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <!-- Custom Shadcn-style Dropdown -->
                                        <div class="relative" x-data="{ open: false }">
                                            <button @click="open = !open" @click.outside="open = false"
                                                class="flex items-center gap-2 h-9 px-3 text-sm font-medium border rounded-md bg-background hover:bg-accent hover:text-accent-foreground transition-colors focus:outline-none focus:ring-1 focus:ring-ring">
                                                <span class="text-muted-foreground mr-1">Connection:</span>
                                                <span x-text="selectedPostgresConnection"></span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                    class="opacity-50">
                                                    <path d="m6 9 6 6 6-6" />
                                                </svg>
                                            </button>
                                            <div x-show="open" x-transition:enter="transition ease-out duration-100"
                                                x-transition:enter-start="opacity-0 scale-95"
                                                x-transition:enter-end="opacity-100 scale-100"
                                                x-transition:leave="transition ease-in duration-75"
                                                x-transition:leave-start="opacity-100 scale-100"
                                                x-transition:leave-end="opacity-0 scale-95"
                                                class="absolute top-full left-0 mt-1 w-48 rounded-md border bg-popover text-popover-foreground shadow-md z-[100] p-1"
                                                style="display: none;">
                                                <template x-for="conn in postgresConnections" :key="conn.name">
                                                    <div @click="changePostgresConnection(conn.name); open = false"
                                                        class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                                        <span x-show="conn.name === selectedPostgresConnection" class="absolute right-2 text-xs">✓</span>
                                                        <div class="flex items-center gap-2">
                                                            <div class="w-2 h-2 rounded-full" :class="conn.status.connected ? 'bg-green-500' : 'bg-red-500'"></div>
                                                            <span x-text="conn.name"></span>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>

                                        <button @click="fetchPostgresConnections()" class="h-9 px-3 text-sm bg-secondary hover:bg-secondary/80 rounded-md transition-colors">
                                            Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Info Cards -->
                            <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
                                <div class="rounded-xl border bg-card text-card-foreground shadow p-6">
                                    <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                        <h3 class="tracking-tight text-sm font-medium">Database</h3>
                                        <div class="text-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                                <path d="M3 5v14c0 1.66 4 3 9 3s 9-1.34 9-3V5"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="text-2xl font-bold" x-text="pgInfo.db_name || 'N/A'"></div>
                                    <p class="text-xs text-muted-foreground"
                                        x-text="'Version: ' + (pgInfo.version || 'Unknown')"></p>
                                </div>
                                <div class="rounded-xl border bg-card text-card-foreground shadow p-6">
                                    <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                        <h3 class="tracking-tight text-sm font-medium">User</h3>
                                        <div class="text-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="text-2xl font-bold" x-text="pgInfo.user || 'N/A'"></div>
                                </div>
                                <div class="rounded-xl border bg-card text-card-foreground shadow p-6">
                                    <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                        <h3 class="tracking-tight text-sm font-medium">Active Sessions</h3>
                                        <div class="text-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="9" cy="7" r="4"></circle>
                                                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="text-2xl font-bold" x-text="pgInfo.sessions || 0"></div>
                                </div>
                                <div class="rounded-xl border bg-card text-card-foreground shadow p-6">
                                    <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                        <h3 class="tracking-tight text-sm font-medium">SSL Mode</h3>
                                        <div class="text-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="text-2xl font-bold" x-text="pgInfo.ssl_mode || 'disable'"></div>
                                </div>
                            </div>

                            <!-- Manual Query Section (New) -->
                            <div class="rounded-md border bg-card shadow-sm">
                                <div class="border-b p-4 flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                                            <polyline points="4 17 10 11 4 5"></polyline>
                                            <line x1="12" y1="19" x2="20" y2="19"></line>
                                        </svg>
                                        <h3 class="font-medium">Manual SQL Query</h3>
                                    </div>
                                    <div class="flex gap-2">
                                        <button @click="runQuery" :disabled="isQueryRunning"
                                            class="h-8 px-3 text-xs bg-primary text-primary-foreground hover:bg-primary/90 rounded-md font-medium flex items-center gap-2 disabled:opacity-50 transition-colors">
                                            <span x-show="isQueryRunning" class="animate-spin">⌛</span>
                                            <span x-text="isQueryRunning ? 'Running...' : 'Run Query'"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="p-0">
                                    <textarea id="sqlEditor"></textarea>
                                </div>
                                <div x-show="queryError"
                                    class="p-4 border-t bg-red-50 dark:bg-red-900/10 text-red-600 dark:text-red-400 text-sm font-mono"
                                    x-text="queryError"></div>
                                <div x-show="queryResults" class="border-t max-h-[400px] overflow-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-muted text-muted-foreground sticky top-0">
                                            <tr>
                                                <template x-if="queryResults && queryResults.length > 0">
                                                    <template x-for="item in Object.keys(queryResults[0])">
                                                        <th class="h-10 px-4 text-left font-medium" x-text="item"></th>
                                                    </template>
                                                </template>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-if="queryResults && queryResults.length > 0">
                                                <template x-for="(row, idx) in queryResults">
                                                    <tr class="border-b hover:bg-muted/50 transition-colors">
                                                        <template x-for="val in Object.values(row)">
                                                            <td class="p-3 align-middle font-mono text-xs whitespace-nowrap"
                                                                x-text="val"></td>
                                                        </template>
                                                    </tr>
                                                </template>
                                            </template>
                                            <template x-if="queryResults && queryResults.length === 0 && !queryError">
                                                <tr>
                                                    <td class="p-4 text-center text-muted-foreground">Query executed
                                                        successfully. No rows returned.</td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Running Queries -->
                            <div class="rounded-md border bg-card shadow-sm">
                                <div class="border-b p-4 flex items-center justify-between">
                                    <h3 class="font-medium">Running Queries</h3>

                                    <div class="flex items-center gap-2">
                                        <!-- Refresh Interval Dropdown -->
                                        <div class="relative" x-data="{ open: false }">
                                            <button @click="open = !open" @click.outside="open = false"
                                                class="flex items-center gap-2 h-8 px-3 text-xs font-medium border rounded-md bg-background hover:bg-accent hover:text-accent-foreground transition-colors focus:outline-none focus:ring-1 focus:ring-ring">
                                                <span class="text-muted-foreground mr-1">Interval:</span>
                                                <span
                                                    x-text="pgRefreshInterval == 2000 ? '2s' : (pgRefreshInterval == 5000 ? '5s' : (pgRefreshInterval == 10000 ? '10s' : '30s'))"></span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                    class="opacity-50">
                                                    <path d="m6 9 6 6 6-6" />
                                                </svg>
                                            </button>
                                            <div x-show="open" x-transition:enter="transition ease-out duration-100"
                                                x-transition:enter-start="opacity-0 scale-95"
                                                x-transition:enter-end="opacity-100 scale-100"
                                                x-transition:leave="transition ease-in duration-75"
                                                x-transition:leave-start="opacity-100 scale-100"
                                                x-transition:leave-end="opacity-0 scale-95"
                                                class="absolute top-full right-0 mt-1 w-32 rounded-md border bg-popover text-popover-foreground shadow-md z-[100] p-1"
                                                style="display: none;">
                                                <div @click="pgRefreshInterval = 2000; updatePgRefreshInterval(); open = false"
                                                    class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                                    <span x-show="pgRefreshInterval == 2000"
                                                        class="absolute right-2 text-xs">✓</span>
                                                    2s
                                                </div>
                                                <div @click="pgRefreshInterval = 5000; updatePgRefreshInterval(); open = false"
                                                    class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                                    <span x-show="pgRefreshInterval == 5000"
                                                        class="absolute right-2 text-xs">✓</span>
                                                    5s
                                                </div>
                                                <div @click="pgRefreshInterval = 10000; updatePgRefreshInterval(); open = false"
                                                    class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                                    <span x-show="pgRefreshInterval == 10000"
                                                        class="absolute right-2 text-xs">✓</span>
                                                    10s
                                                </div>
                                                <div @click="pgRefreshInterval = 30000; updatePgRefreshInterval(); open = false"
                                                    class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                                    <span x-show="pgRefreshInterval == 30000"
                                                        class="absolute right-2 text-xs">✓</span>
                                                    30s
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Toggle Auto-Refresh Button -->
                                        <button @click="togglePgRefresh()"
                                            :class="pgRefreshActive ? 'bg-green-500/10 text-green-600 hover:bg-green-500/20 border-green-200' : 'bg-secondary text-secondary-foreground hover:bg-secondary/80'"
                                            class="h-8 px-3 text-xs rounded-md transition-colors font-medium border border-transparent">
                                            <span
                                                x-text="pgRefreshActive ? 'Auto-Refresh: ON' : 'Enable Auto-Refresh'"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="overflow-x-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-muted text-muted-foreground">
                                            <tr>
                                                <th class="h-10 px-4 text-left font-medium">PID</th>
                                                <th class="h-10 px-4 text-left font-medium">User</th>
                                                <th class="h-10 px-4 text-left font-medium">Duration</th>
                                                <th class="h-10 px-4 text-left font-medium">Query</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="q in pgQueries" :key="q.pid">
                                                <tr class="border-b hover:bg-muted/50 transition-colors">
                                                    <td class="p-3 px-4 font-mono text-xs" x-text="q.pid"></td>
                                                    <td class="p-3 px-4" x-text="q.usename"></td>
                                                    <td class="p-3 px-4 text-yellow-600 dark:text-yellow-400 font-medium"
                                                        x-text="q.duration"></td>
                                                    <td class="p-3 px-4 font-mono text-xs text-muted-foreground truncate max-w-[300px]"
                                                        x-text="q.query" :title="q.query"></td>
                                                </tr>
                                            </template>
                                            <template x-if="!pgQueries || pgQueries.length === 0">
                                                <tr>
                                                    <td colspan="4" class="p-8 text-center text-muted-foreground">No
                                                        active queries found</td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- MongoDB Tab -->
                <div x-show="activeTab === 'mongo'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-4"
                    x-transition:enter-end="opacity-100 translate-y-0">

                    <template x-if="!infraStatus.mongo">
                        <div class="p-12 text-center text-muted-foreground rounded-md border border-dashed">
                            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round"
                                stroke-linejoin="round" class="mx-auto mb-4 opacity-50">
                                <path d="M17.6 9.5C17.6 14.1944 13.8 18 9.1 18C4.4 18 0.6 14.1944 0.6 9.5C0.6 4.80558 4.4 1 9.1 1C13.8 1 17.6 4.80558 17.6 9.5Z"></path>
                                <path d="M12.1 9.5C12.1 11.9853 10 14 7.55 14C5.1 14 3 11.9853 3 9.5C3 7.01469 5.1 5 7.55 5C10 5 12.1 7.01469 12.1 9.5Z"></path>
                                <path d="M7.55 9.5V14"></path>
                                <path d="M7.55 5V9.5"></path>
                                <path d="M9.1 1V18"></path>
                            </svg>
                            <h3 class="text-lg font-medium">MongoDB is disconnected</h3>
                            <p class="mt-1">Check your configuration and ensure the database is running.</p>
                        </div>
                    </template>

                    <template x-if="infraStatus.mongo">
                        <div class="space-y-6">
                            <!-- Database Connection Selector -->
                            <div class="rounded-md border bg-card shadow-sm p-4">
                                <div class="flex items-center gap-4">
                                    <div class="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                                            <path d="M17.6 9.5C17.6 14.1944 13.8 18 9.1 18C4.4 18 0.6 14.1944 0.6 9.5C0.6 4.80558 4.4 1 9.1 1C13.8 1 17.6 4.80558 17.6 9.5Z"></path>
                                            <path d="M12.1 9.5C12.1 11.9853 10 14 7.55 14C5.1 14 3 11.9853 3 9.5C3 7.01469 5.1 5 7.55 5C10 5 12.1 7.01469 12.1 9.5Z"></path>
                                            <path d="M7.55 9.5V14"></path>
                                            <path d="M7.55 5V9.5"></path>
                                            <path d="M9.1 1V18"></path>
                                        </svg>
                                        <span class="font-medium">Database Connection:</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <!-- Custom Shadcn-style Dropdown -->
                                        <div class="relative" x-data="{ open: false }">
                                            <button @click="open = !open" @click.outside="open = false"
                                                class="flex items-center gap-2 h-9 px-3 text-sm font-medium border rounded-md bg-background hover:bg-accent hover:text-accent-foreground transition-colors focus:outline-none focus:ring-1 focus:ring-ring">
                                                <span class="text-muted-foreground mr-1">Connection:</span>
                                                <span x-text="selectedMongoConnection"></span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                                                    viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                                    stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                                                    class="opacity-50">
                                                    <path d="m6 9 6 6 6-6" />
                                                </svg>
                                            </button>
                                            <div x-show="open" x-transition:enter="transition ease-out duration-100"
                                                x-transition:enter-start="opacity-0 scale-95"
                                                x-transition:enter-end="opacity-100 scale-100"
                                                x-transition:leave="transition ease-in duration-75"
                                                x-transition:leave-start="opacity-100 scale-100"
                                                x-transition:leave-end="opacity-0 scale-95"
                                                class="absolute top-full left-0 mt-1 w-48 rounded-md border bg-popover text-popover-foreground shadow-md z-[100] p-1"
                                                style="display: none;">
                                                <template x-for="conn in mongoConnections" :key="conn.name">
                                                    <div @click="changeMongoConnection(conn.name); open = false"
                                                        class="relative flex cursor-pointer select-none items-center rounded-sm px-2 py-1.5 text-xs outline-none hover:bg-accent hover:text-accent-foreground">
                                                        <span x-show="conn.name === selectedMongoConnection" class="absolute right-2 text-xs">✓</span>
                                                        <div class="flex items-center gap-2">
                                                            <div class="w-2 h-2 rounded-full" :class="conn.status.connected ? 'bg-green-500' : 'bg-red-500'"></div>
                                                            <span x-text="conn.name"></span>
                                                        </div>
                                                    </div>
                                                </template>
                                            </div>
                                        </div>

                                        <button @click="fetchMongoConnections()" class="h-9 px-3 text-sm bg-secondary hover:bg-secondary/80 rounded-md transition-colors">
                                            Refresh
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Info Cards -->
                            <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
                                <div class="rounded-xl border bg-card text-card-foreground shadow p-6">
                                    <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                        <h3 class="tracking-tight text-sm font-medium">Database</h3>
                                        <div class="text-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                                <path d="M3 5v14c0 1.66 4 3 9 3s 9-1.34 9-3V5"></path>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="text-2xl font-bold" x-text="mongoInfo.database || 'N/A'"></div>
                                </div>
                                <div class="rounded-xl border bg-card text-card-foreground shadow p-6">
                                    <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                        <h3 class="tracking-tight text-sm font-medium">Collections</h3>
                                        <div class="text-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <rect x="3" y="3" width="7" height="7"></rect>
                                                <rect x="14" y="3" width="7" height="7"></rect>
                                                <rect x="14" y="14" width="7" height="7"></rect>
                                                <rect x="3" y="14" width="7" height="7"></rect>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="text-2xl font-bold" x-text="mongoInfo.collections?.length || 0"></div>
                                    <p class="text-xs text-muted-foreground mt-1">
                                        <template x-for="(collection, index) in mongoInfo.collections || []">
                                            <span x-text="collection"></span><span x-show="index < (mongoInfo.collections?.length - 1 || 0)" x-text="', '"></span>
                                        </template>
                                    </p>
                                </div>
                                <div class="rounded-xl border bg-card text-card-foreground shadow p-6">
                                    <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                        <h3 class="tracking-tight text-sm font-medium">Documents</h3>
                                        <div class="text-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                                <polyline points="14,2 14,8 20,8"></polyline>
                                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                                <polyline points="10,9 9,9 8,9"></polyline>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="text-2xl font-bold" x-text="mongoInfo.stats?.objects || 0"></div>
                                </div>
                                <div class="rounded-xl border bg-card text-card-foreground shadow p-6">
                                    <div class="flex flex-row items-center justify-between space-y-0 pb-2">
                                        <h3 class="tracking-tight text-sm font-medium">Storage Size</h3>
                                        <div class="text-primary">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                                stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                <polyline points="21 12 21 12"></polyline>
                                                <rect width="20" height="8" x="2" y="4" rx="2" ry="2"></rect>
                                                <line x1="10" y1="8" x2="14" y2="8"></line>
                                            </svg>
                                        </div>
                                    </div>
                                    <div class="text-2xl font-bold" x-text="mongoInfo.stats?.storageSize ? Math.round(mongoInfo.stats.storageSize / 1024 / 1024) + 'MB' : 'N/A'"></div>
                                </div>
                            </div>

                            <!-- Manual Query Section -->
                            <div class="rounded-md border bg-card shadow-sm">
                                <div class="border-b p-4 flex items-center justify-between">
                                    <div class="flex items-center gap-2">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round" class="text-primary">
                                            <polyline points="4 17 10 11 4 5"></polyline>
                                            <line x1="12" y1="19" x2="20" y2="19"></line>
                                        </svg>
                                        <h3 class="font-medium">Manual MongoDB Query</h3>
                                    </div>
                                    <div class="flex gap-2">
                                        <button @click="runMongoQuery" :disabled="isMongoQueryRunning"
                                            class="h-8 px-3 text-xs bg-primary text-primary-foreground hover:bg-primary/90 rounded-md font-medium flex items-center gap-2 disabled:opacity-50 transition-colors">
                                            <span x-show="isMongoQueryRunning" class="animate-spin">⌛</span>
                                            <span x-text="isMongoQueryRunning ? 'Running...' : 'Run Query'"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="p-4 space-y-4">
                                    <div class="grid gap-4 md:grid-cols-2">
                                        <div>
                                            <label class="text-sm font-medium mb-2 block">Collection</label>
                                            <input type="text" x-model="mongoQuery.collection"
                                                placeholder="collection_name"
                                                class="w-full h-9 rounded-md border border-input bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
                                        </div>
                                        <div>
                                            <label class="text-sm font-medium mb-2 block">Query (JSON)</label>
                                            <textarea x-model="mongoQuery.query" rows="3"
                                                placeholder='{"field": "value"} or {} for all'
                                                class="w-full rounded-md border border-input bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50 font-mono"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <div x-show="mongoQueryError"
                                    class="p-4 border-t bg-red-50 dark:bg-red-900/10 text-red-600 dark:text-red-400 text-sm font-mono"
                                    x-text="mongoQueryError"></div>
                                <div x-show="mongoQueryResults" class="border-t max-h-[400px] overflow-auto">
                                    <table class="w-full text-sm">
                                        <thead class="bg-muted text-muted-foreground sticky top-0">
                                            <tr>
                                                <template x-if="mongoQueryResults && mongoQueryResults.length > 0">
                                                    <template x-for="key in Object.keys(mongoQueryResults[0])">
                                                        <th class="h-10 px-4 text-left font-medium" x-text="key"></th>
                                                    </template>
                                                </template>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-if="mongoQueryResults && mongoQueryResults.length > 0">
                                                <template x-for="(row, idx) in mongoQueryResults">
                                                    <tr class="border-b hover:bg-muted/50 transition-colors">
                                                        <template x-for="val in Object.values(row)">
                                                            <td class="p-3 align-middle font-mono text-xs whitespace-nowrap"
                                                                x-text="typeof val === 'object' ? JSON.stringify(val) : val"></td>
                                                        </template>
                                                    </tr>
                                                </template>
                                            </template>
                                            <template x-if="mongoQueryResults && mongoQueryResults.length === 0 && !mongoQueryError">
                                                <tr>
                                                    <td class="p-4 text-center text-muted-foreground" :colspan="Object.keys(mongoQueryResults[0] || {}).length">Query executed
                                                        successfully. No documents returned.</td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>

                <!-- Kafka Tab -->
                <div x-show="activeTab === 'kafka'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-4"
                    x-transition:enter-end="opacity-100 translate-y-0">
                    <div class="p-6 rounded-xl border bg-card shadow-sm text-center">
                        <div class="w-12 h-12 bg-muted rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Kafka Debugger</h3>
                        <p class="text-muted-foreground">Inspect topics, consumer groups, and stream messages.</p>
                        <div class="mt-8 bg-muted p-4 rounded-md text-left font-mono text-sm overflow-auto max-h-64">
                            <pre x-text="kafkaMsg || 'No active connection...'"></pre>
                        </div>
                    </div>
                </div>

                <!-- Cron Tab -->
                <div x-show="activeTab === 'cron'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-4"
                    x-transition:enter-end="opacity-100 translate-y-0">
                    <div class="rounded-md border bg-card">
                        <div class="relative w-full overflow-auto">
                            <table class="w-full caption-bottom text-sm">
                                <thead class="[&_tr]:border-b">
                                    <tr
                                        class="border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted">
                                        <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                            Job
                                            Name</th>
                                        <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                            Schedule</th>
                                        <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                            Last
                                            Run</th>
                                        <th class="h-12 px-4 text-left align-middle font-medium text-muted-foreground">
                                            Next
                                            Run</th>
                                    </tr>
                                </thead>
                                <tbody class="[&_tr:last-child]:border-0">
                                    <template x-for="job in cronJobs">
                                        <tr class="border-b transition-colors hover:bg-muted/50">
                                            <td class="p-4 align-middle font-medium" x-text="job.name"></td>
                                            <td class="p-4 align-middle font-mono text-xs" x-text="job.schedule"></td>
                                            <td class="p-4 align-middle text-muted-foreground"
                                                x-text="job.last_run.startsWith('0001') ? 'Never' : new Date(job.last_run).toLocaleString()">
                                            </td>
                                            <td class="p-4 align-middle text-muted-foreground"
                                                x-text="new Date(job.next_run).toLocaleString()"></td>
                                        </tr>
                                    </template>
                                    <tr x-show="cronJobs.length === 0">
                                        <td colspan="4" class="p-4 text-center text-muted-foreground">No cron jobs
                                            configured.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>



                <!-- Config Tab -->
                <div x-show="activeTab === 'config'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-4"
                    x-transition:enter-end="opacity-100 translate-y-0">
                    <div class="p-6 rounded-xl border bg-card shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-xl font-bold">App Configuration</h3>
                                <p class="text-muted-foreground text-sm">Edit <code>config.yaml</code> directly.</p>
                            </div>
                            <div class="flex gap-2">
                                <button @click="backupConfig()"
                                    class="h-8 px-3 text-xs bg-yellow-500 hover:bg-yellow-600 text-white rounded-md transition-colors font-medium">Backup
                                    Config</button>
                                <button @click="fetchConfig()"
                                    class="h-8 px-3 text-xs bg-secondary hover:bg-secondary/80 rounded-md transition-colors">Reset</button>
                                <button @click="saveConfigText()"
                                    class="h-8 px-3 text-xs bg-primary text-primary-foreground hover:bg-primary/90 rounded-md transition-colors font-medium">Save
                                    Changes</button>
                            </div>
                        </div>
                        <div class="rounded-md border border-input shadow-sm">
                            <textarea id="configEditor"></textarea>
                        </div>
                        <p class="text-xs text-muted-foreground mt-2">Note: Changes require a server restart to take
                            effect.</p>
                    </div>
                </div>

                <!-- Banner Tab -->
                <div x-show="activeTab === 'banner'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-4"
                    x-transition:enter-end="opacity-100 translate-y-0">
                    <div class="p-6 rounded-xl border bg-card shadow-sm">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h3 class="text-xl font-bold">Banner Editor</h3>
                                <p class="text-muted-foreground text-sm">Edit the startup banner (ASCII Art supported)
                                </p>
                            </div>
                            <div class="flex gap-2">
                                <button @click="fetchBanner()"
                                    class="h-8 px-3 text-xs bg-secondary hover:bg-secondary/80 rounded-md transition-colors">Reset</button>
                                <button @click="saveBanner()"
                                    class="h-8 px-3 text-xs bg-primary text-primary-foreground hover:bg-primary/90 rounded-md transition-colors font-medium">Save
                                    Changes</button>
                            </div>
                        </div>
                        <div class="rounded-md border border-input shadow-sm">
                            <textarea id="bannerEditor"></textarea>
                        </div>
                    </div>
                </div>

                <!-- User Settings Tab -->
                <div x-show="activeTab === 'settings'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 translate-y-4"
                    x-transition:enter-end="opacity-100 translate-y-0"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100 translate-y-0"
                    x-transition:leave-end="opacity-0 translate-y-4">
                    <div class="rounded-md border bg-card shadow-sm">
                        <div class="flex items-center justify-between border-b p-6">
                            <div>
                                <h2 class="text-xl font-semibold">User Settings</h2>
                                <p class="text-sm text-muted-foreground mt-1">Manage your profile and security settings
                                </p>
                            </div>
                        </div>
                        <div class="p-6 space-y-6">
                            <!-- Profile Photo Section -->
                            <div class="space-y-4">
                                <h3 class="text-sm font-semibold">Profile Photo</h3>
                                <div class="flex items-center gap-4">
                                    <div
                                        class="h-24 w-24 rounded-full bg-muted flex items-center justify-center overflow-hidden border-2 border-border">
                                        <template x-if="userSettings.photoPath">
                                            <img :src="'/api/user/photos/' + userSettings.photoPath" alt="Profile"
                                                class="h-full w-full object-cover">
                                        </template>
                                        <template x-if="!userSettings.photoPath">
                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                class="h-12 w-12 text-muted-foreground" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                                                <circle cx="12" cy="7" r="4"></circle>
                                            </svg>
                                        </template>
                                    </div>
                                    <div class="flex-1 space-y-2">
                                        <input type="file" @change="uploadPhoto" accept="image/jpeg,image/png,image/gif"
                                            class="block w-full text-sm text-muted-foreground file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-medium file:bg-primary file:text-primary-foreground hover:file:bg-primary/90 cursor-pointer">
                                        <p class="text-xs text-muted-foreground">JPG, PNG or GIF (max 2MB)</p>
                                        <button x-show="userSettings.photoPath" @click="deletePhoto"
                                            class="text-xs text-destructive hover:underline">Delete Photo</button>
                                    </div>
                                </div>
                            </div>

                            <div class="border-t"></div>

                            <!-- Username Section -->
                            <div class="space-y-4">
                                <h3 class="text-sm font-semibold">Display Name</h3>
                                <div class="flex gap-2">
                                    <input type="text" x-model="userSettings.username" placeholder="Username"
                                        class="flex-1 h-10 rounded-md border border-input bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
                                    <button @click="updateUsername"
                                        class="h-10 px-4 text-sm bg-primary text-primary-foreground hover:bg-primary/90 rounded-md font-medium">Save</button>
                                </div>
                            </div>

                            <div class="border-t"></div>

                            <!-- Password Section -->
                            <div class="space-y-4">
                                <h3 class="text-sm font-semibold">Change Password</h3>
                                <div class="space-y-3">
                                    <input type="password" x-model="passwordForm.current" placeholder="Current Password"
                                        class="w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
                                    <input type="password" x-model="passwordForm.new" placeholder="New Password"
                                        class="w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
                                    <input type="password" x-model="passwordForm.confirm"
                                        placeholder="Confirm New Password"
                                        class="w-full h-10 rounded-md border border-input bg-background px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/50">
                                    <button @click="changePassword"
                                        class="h-10 px-4 text-sm bg-primary text-primary-foreground hover:bg-primary/90 rounded-md font-medium">Change
                                        Password</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Maintenance Tab -->
                <div x-show="activeTab === 'maintenance'" class="space-y-6"
                    x-transition:enter="transition ease-out duration-300"
                    x-transition:enter-start="opacity-0 translate-y-4"
                    x-transition:enter-end="opacity-100 translate-y-0">
                    <div class="rounded-md border bg-card shadow-sm">
                        <div class="border-b p-6">
                            <h2 class="text-xl font-semibold">System Maintenance</h2>
                            <p class="text-sm text-muted-foreground mt-1">Manage application lifecycle and dangerous
                                operations.</p>
                        </div>
                        <div class="p-6">
                            <div
                                class="rounded-lg border border-red-200 bg-red-50 dark:border-red-900/50 dark:bg-red-900/10 p-4">
                                <div class="flex items-start gap-4">
                                    <div
                                        class="p-2 bg-red-100 dark:bg-red-900/30 rounded-full text-red-600 dark:text-red-400">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                            stroke-linecap="round" stroke-linejoin="round">
                                            <path
                                                d="M18.37 2.63 2.63 18.37A2 2 0 0 0 4.13 22h15.74a2 2 0 0 0 1.53-3.05l-15.74-15.74A2 2 0 0 0 2.63 6.27">
                                            </path>
                                            <path d="M12 9v2"></path>
                                            <path d="M12 17h.01"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <h3 class="text-sm font-bold text-red-900 dark:text-red-200">Restart Application
                                        </h3>
                                        <p class="text-sm text-red-800/80 dark:text-red-300/80 mt-2 leading-relaxed">
                                            Restarting the service will temporarily disrupt all active connections and
                                            APIs.
                                            The dashboard will attempt to reconnect automatically after a few seconds.
                                        </p>
                                        <ul
                                            class="list-disc list-inside mt-3 mb-4 text-xs opacity-90 space-y-1 text-red-800/70 dark:text-red-300/70">
                                            <li>In-memory cache will be cleared.</li>
                                            <li>Active WebSocket/SSE connections will disconnect.</li>
                                            <li>Scheduled cron jobs may be interrupted.</li>
                                        </ul>
                                        <button @click="restartService()"
                                            class="inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-destructive text-destructive-foreground hover:bg-destructive/90 h-9 px-4 shadow-sm">
                                            Restart Service
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div x-show="redisModalOpen"
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm" style="display: none;">
        <div
            class="bg-card w-full max-w-lg p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-800 text-card-foreground">
            <h3 class="text-lg font-bold mb-4">Value: <span class="font-mono text-primary"
                    x-text="selectedRedisKey"></span></h3>
            <div class="bg-muted p-4 rounded-md overflow-x-auto text-xs font-mono max-h-[300px] mb-4">
                <span x-text="selectedRedisValue"></span>
            </div>
            <button @click="redisModalOpen = false"
                class="w-full bg-primary text-primary-foreground hover:bg-primary/90 h-10 rounded-md font-medium">Close</button>
        </div>
    </div>

    <!-- Notyf JS (Local Offline) -->
    <script src="/assets/vendor/notyf/notyf.min.js"></script>
    <script src="/assets/js/app.js?v=1.1"></script>
</body>

</html>
